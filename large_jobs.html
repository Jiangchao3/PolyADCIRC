

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Large Jobs &mdash; PolyADCIRC 0.2.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="PolyADCIRC 0.2.0 documentation" href="index.html"/>
        <link rel="next" title="“All” about land use and land classifications" href="landuse_stuff.html"/>
        <link rel="prev" title="Limited Variable Bathymetry" href="submerged_wall.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> PolyADCIRC</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="overview.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#package-layout">Package Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#code-overview">Code Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#internal-dependencies">Internal dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#external-dependencies">External dependencies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="running_on_lonestar.html">Running on Lonestar</a><ul>
<li class="toctree-l2"><a class="reference internal" href="running_on_lonestar.html#file-system-setup">File System Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="running_on_lonestar.html#python-scripts">Python Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="running_on_lonestar.html#job-submission-script">Job Submission Script</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="submerged_wall.html">Limited Variable Bathymetry</a><ul>
<li class="toctree-l2"><a class="reference internal" href="submerged_wall.html#few-walls">few_walls</a></li>
<li class="toctree-l2"><a class="reference internal" href="submerged_wall.html#load-few-walls">load_few_walls</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Large Jobs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#concatenation-2">concatenation_2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#concatenate-many">concatenate_many</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="landuse_stuff.html">All about mapping landuse data to the mesh</a><ul>
<li class="toctree-l2"><a class="reference internal" href="landuse_stuff.html#preparing-basis-vector-files-from-gap-nlcd-data">Preparing basis vector files from GAP/NLCD data</a></li>
<li class="toctree-l2"><a class="reference internal" href="landuse_stuff.html#comparing-the-python-vs-griddata-v1-32-f90-reconstructions">Comparing the Python vs. <strong class="program">Griddata_v1.32.F90</strong> Reconstructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="landuse_stuff.html#manufacturing-gap-data">Manufacturing GAP data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="subdomain.html">Running with Subdomain ADCIRC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="subdomain.html#getting-the-subdomain-adcirc-code">Getting the Subdomain ADCIRC Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="subdomain.html#modifying-subdomain-adcirc">Modifying Subdomain ADCIRC</a></li>
<li class="toctree-l2"><a class="reference internal" href="subdomain.html#setting-up-the-subdomain-grid-dir">Setting up the Subdomain <code class="docutils literal"><span class="pre">grid_dir</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="subdomain.html#setting-up-your-landuse-folders">Setting up your <code class="docutils literal"><span class="pre">landuse_##</span></code> folders</a></li>
<li class="toctree-l2"><a class="reference internal" href="subdomain.html#running-polyadcirc-with-subdomains">Running PolyADCIRC with Subdomains</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="references.html">Some References and Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo_list.html">Todo List</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">PolyADCIRC</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Large Jobs</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/large_jobs.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="large-jobs">
<h1>Large Jobs<a class="headerlink" href="#large-jobs" title="Permalink to this headline">¶</a></h1>
<p>PolyADCIRC runs batches of simulations of size <code class="docutils literal"><span class="pre">num_of_parallel_runs</span></code>. PolyADCIRC
relies on <a class="reference external" href="http://www.gnu.org/software/parallel/">GNU Parallel</a> to handle
simultaneously running a batch of serial jobs in parallel. PolyADCIRC relies on
<strong class="program">ibrun</strong>, a <a class="reference external" href="http://www.tacc.utexas.edu/user-services/user-guides">TACC</a> specific batch MPI
launch command to handle simulataneously running a batch of parallel jobs in
parallel. Based on user inputs PolyADCIRC writes the appropriate Bash scripts
which are run using the <code class="xref py py-meth docutils literal"><span class="pre">subprocess.POpen()</span></code> command. Once the batch size
(<code class="docutils literal"><span class="pre">num_of_parallel_runs</span></code>) gets too large the user may encounter</p>
<div class="highlight-python"><div class="highlight"><pre>tail: write error: Broken pipe
</pre></div>
</div>
<p>We are currently working to eliminate this problem. The current work around is
to reduce your batch size and break your job up into multiple jobs. These jobs
may then be submitted to the queue and either run independently or
sequentially. When doing so make sure that the run scripts specify a different
<code class="docutils literal"><span class="pre">save_dir</span></code>, <code class="docutils literal"><span class="pre">save_file</span></code>, and <code class="docutils literal"><span class="pre">script_name</span></code> for each job. After your jobs
complete the data may be concatenated into a single file. This file will have
the same structure as if a single job was run. You might also want to create a
<code class="docutils literal"><span class="pre">crontab</span></code> to periodically clear our your <code class="docutils literal"><span class="pre">.sge</span></code> directory.</p>
<div class="section" id="concatenation-2">
<h2>concatenation_2<a class="headerlink" href="#concatenation-2" title="Permalink to this headline">¶</a></h2>
<p>This file demonstrates concatenating data from two separate jobs.</p>
<p>Import necessary modules:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">polyadcirc.run_framework.domain</span> <span class="kn">as</span> <span class="nn">dom</span>
<span class="kn">import</span> <span class="nn">polyadcirc.run_framework.random_wall</span> <span class="kn">as</span> <span class="nn">rmw</span>
</pre></div>
</div>
<p>Specifiy directories for the jobs that were run:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">base_dir</span> <span class="o">=</span> <span class="s">&#39;/h1/lgraham/workspace&#39;</span>
<span class="n">grid_dir</span> <span class="o">=</span> <span class="n">base_dir</span> <span class="o">+</span> <span class="s">&#39;/ADCIRC_landuse/Inlet/inputs/poly_walls&#39;</span>
<span class="n">save_dir1</span> <span class="o">=</span> <span class="n">base_dir</span> <span class="o">+</span> <span class="s">&#39;/ADCIRC_landuse/Inlet/runs/poly_wall1&#39;</span>
<span class="n">save_dir2</span> <span class="o">=</span> <span class="n">base_dir</span> <span class="o">+</span> <span class="s">&#39;/ADCIRC_landuse/Inlet/runs/poly_wall2&#39;</span>
<span class="n">basis_dir</span> <span class="o">=</span> <span class="n">base_dir</span> <span class="o">+</span> <span class="s">&#39;/ADCIRC_landuse/Inlet/landuse_basis/gap/beach_walls_2lands&#39;</span>
</pre></div>
</div>
<p>Specify the save file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">save_file</span> <span class="o">=</span> <span class="s">&#39;py_save_file&#39;</span>
</pre></div>
</div>
<p>Load the data from both runs:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">main_run</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">mann_pts</span><span class="p">,</span> <span class="n">wall_pts</span><span class="p">,</span> <span class="n">points</span> <span class="o">=</span> <span class="n">rmw</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">save_file</span><span class="p">,</span> <span class="n">base_dir</span><span class="p">,</span>
    <span class="n">grid_dir</span><span class="p">,</span> <span class="n">save_dir1</span><span class="p">,</span> <span class="n">basis_dir</span><span class="p">)</span>
<span class="n">other_run</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">mann_pts2</span><span class="p">,</span> <span class="n">wall_pts2</span><span class="p">,</span> <span class="n">points2</span> <span class="o">=</span> <span class="n">rmw</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">save_file</span><span class="p">,</span>
    <span class="n">base_dir</span><span class="p">,</span> <span class="n">grid_dir</span><span class="p">,</span> <span class="n">save_dir2</span><span class="p">,</span> <span class="n">basis_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>Concatenate the data from both runs and save to a
<a class="reference internal" href="polyadcirc.run_framework.html#polyadcirc.run_framework.random_wall.runSet" title="polyadcirc.run_framework.random_wall.runSet"><code class="xref py py-class docutils literal"><span class="pre">runSet</span></code></a> object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cated</span> <span class="o">=</span> <span class="n">main_run</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">other_run</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">points2</span><span class="p">)</span>
</pre></div>
</div>
<p>Store the concatenated version of <code class="docutils literal"><span class="pre">points</span></code> in a dictonary object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mdat</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">mdat</span><span class="p">[</span><span class="s">&#39;points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cated</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Concatenate and store <code class="docutils literal"><span class="pre">mann_pts</span></code> and <code class="docutils literal"><span class="pre">wall_pts</span></code> in the dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mdat</span><span class="p">[</span><span class="s">&#39;mann_pts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">mann_pts1</span><span class="p">,</span> <span class="n">mann_pts2</span><span class="p">),</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">points1</span><span class="o">.</span><span class="n">ndim</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">mdat</span><span class="p">[</span><span class="s">&#39;wall_pts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">wall_pts1</span><span class="p">,</span> <span class="n">wall_pts2</span><span class="p">),</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">points1</span><span class="o">.</span><span class="n">ndim</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Save the data to a new save file in <code class="docutils literal"><span class="pre">save_dir1</span></code> as <code class="docutils literal"><span class="pre">cat_file.mat</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">main_run</span><span class="o">.</span><span class="n">update_mdict</span><span class="p">(</span><span class="n">mdat</span><span class="p">)</span>
<span class="n">main_run</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">mdat</span><span class="p">,</span> <span class="s">&#39;cat_file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="concatenate-many">
<h2>concatenate_many<a class="headerlink" href="#concatenate-many" title="Permalink to this headline">¶</a></h2>
<p>This file demonstrates concatenating data from seven different jobs.</p>
<p>Import necessary modules:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">polyadcirc.run_framework.domain</span> <span class="kn">as</span> <span class="nn">dom</span>
<span class="kn">import</span> <span class="nn">polyadcirc.run_framework.random_wall</span> <span class="kn">as</span> <span class="nn">rmw</span>
</pre></div>
</div>
<p>Specify the directories for the jobs and the base string for the <code class="docutils literal"><span class="pre">save_dir</span></code>
and <code class="docutils literal"><span class="pre">save_file</span></code>. The name pattern for the <code class="docutils literal"><span class="pre">save_dir</span></code> and <code class="docutils literal"><span class="pre">save_file</span></code> is
<code class="docutils literal"><span class="pre">name+str(n)</span></code> where <code class="docutils literal"><span class="pre">n</span></code> indicates this the the files and directory for the
nth job:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">base_dir</span> <span class="o">=</span> <span class="s">&#39;/h1/lgraham/workspace&#39;</span>
<span class="n">grid_dir</span> <span class="o">=</span> <span class="n">base_dir</span> <span class="o">+</span> <span class="s">&#39;/ADCIRC_landuse/Inlet/inputs/poly_walls&#39;</span>
<span class="n">save_dir</span> <span class="o">=</span> <span class="n">base_dir</span> <span class="o">+</span> <span class="s">&#39;/ADCIRC_landuse/Inlet/runs/poly_wall&#39;</span>
<span class="n">basis_dir</span> <span class="o">=</span> <span class="n">base_dir</span> <span class="o">+</span> <span class="s">&#39;/ADCIRC_landuse/Inlet/landuse_basis/gap/beach_walls_2lands&#39;</span>

<span class="n">save_file</span> <span class="o">=</span> <span class="s">&#39;py_save_file&#39;</span>
</pre></div>
</div>
<p>Load the data from the first job:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">main_run</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">mann_pts</span><span class="p">,</span> <span class="n">wall_pts</span><span class="p">,</span> <span class="n">points</span> <span class="o">=</span> <span class="n">rmw</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">save_file</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="p">,</span>
    <span class="n">base_dir</span><span class="p">,</span> <span class="n">grid_dir</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">+</span><span class="s">&#39;_0&#39;</span><span class="p">,</span> <span class="n">basis_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>Load and concatenate the data for the remaning runs:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">):</span>
    <span class="n">save_file2</span> <span class="o">=</span> <span class="n">save_file</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c"># construct the save_file name</span>
    <span class="n">save_dir2</span> <span class="o">=</span> <span class="n">save_dir</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c"># construct the save_dir name</span>
    <span class="c"># load the data</span>
    <span class="n">other_run</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">mann_pts2</span><span class="p">,</span> <span class="n">wall_pts2</span><span class="p">,</span> <span class="n">points2</span> <span class="o">=</span> <span class="n">rmw</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">save_file2</span><span class="p">,</span>
        <span class="n">base_dir</span><span class="p">,</span> <span class="n">grid_dir</span><span class="p">,</span> <span class="n">save_dir2</span><span class="p">,</span><span class="n">basis_dir</span><span class="p">)</span>
    <span class="c"># concatenate the data</span>
    <span class="n">run</span><span class="p">,</span> <span class="n">points</span> <span class="o">=</span> <span class="n">main_run</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">other_run</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">points2</span><span class="p">)</span>
</pre></div>
</div>
<p>Save the data to <code class="docutils literal"><span class="pre">save_dir+'_0'</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mdat</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">mdat</span><span class="p">[</span><span class="s">&#39;points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span>

<span class="n">main_run</span><span class="o">.</span><span class="n">update_mdict</span><span class="p">(</span><span class="n">mdat</span><span class="p">)</span>
<span class="n">main_run</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">mdat</span><span class="p">,</span> <span class="s">&#39;poly7_file&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that in this example <code class="docutils literal"><span class="pre">mann_pts</span></code>
and <code class="docutils literal"><span class="pre">wall_pts</span></code> are NOT saved. These two arrays have been stitched together
into the <code class="docutils literal"><span class="pre">points</span></code> array using <code class="docutils literal"><span class="pre">numpy.vstack((np.repeat(wall_points,</span>
<span class="pre">s_p_wall,1),</span> <span class="pre">mann_pts))</span></code> in
<a class="reference internal" href="polyadcirc.run_framework.html#polyadcirc.run_framework.random_wall.runSet.run_points" title="polyadcirc.run_framework.random_wall.runSet.run_points"><code class="xref py py-meth docutils literal"><span class="pre">polyadcirc.run_framework.random_wall.runSet.run_points()</span></code></a> into a single
array.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="landuse_stuff.html" class="btn btn-neutral float-right" title="“All” about land use and land classifications">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="submerged_wall.html" class="btn btn-neutral" title="Limited Variable Bathymetry"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013, Lindley Graham.
      Last updated on Jan 21, 2016.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>